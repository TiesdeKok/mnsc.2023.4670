# Data & Code for the paper "*How Resilient are Firms’ Financial Reporting Processes?*" published in Management Science


## Overview

This replication package contains the data and code used to construct all the results in *How Resilient are Firms’ Financial Reporting Processes?* by deHaan, de Kok\*, Matsumoto, and Rodriguez-Vazquez.    

Paper links:   
- [Management Science](https://pubsonline.informs.org/doi/abs/10.1287/mnsc.2023.4670)    
- [SSRN](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4239246)    

\* *Corresponding data & code author - Ties de Kok - tdekok@uw.edu*

The replication package is organized as follows:

- `0_data` is where the raw source data is stored.
    - Not included, but instructions on how to obtain them are included below.
- `1_code` contains the Python, SAS, and Stata code used to construct the intermediate and final results.
- `2_pipeline` is where the intermediate data is stored.
    - Not included, but fully generated by the code in `1_code`.
- `3_results` is where the final SAS and Stata log files are stored after running the code. 
    - The intermediate log outputs of the Python code are embedded in the Jupiter Notebooks in `1_code`.
    - The Stata & SAS log files are included in the `3_output/logs` folder. 

## A note on the folder structure

The basic principle of the provided folder structure is that `0_data` + `1_code` are the only folders that are needed to reproduce the results. The content of the `2_pipeline` and `3_results` folders is completely produced by the code in `1_code`. 

For a more in-depth discussion on this specific folder structure, see: [folder structure blog post](https://towardsdatascience.com/how-to-keep-your-research-projects-organized-part-1-folder-structure-10bd56034d3a).

# End-to-end replication requirements

## Software 

- Python
	- Python 3.6+ is required 
	- A series of external packages are required, which are all detailed in the `environment.yml` file, which is included in the `1_code` folder. 
		- You can recreate the `covid-empirical` environment by running `conda env create -f environment.yml`
	- The only dependency not included in the `environment.yml` are the `Spacy` language models, which can be downloaded using `python -m spacy download en_core_web_sm` and `python -m spacy download en_core_web_lg`.
	- The primary Python code is provided through Jupyter Notebook (`.ipynb`) files, which can be opened through Jupyter or by using a modern IDE such as Visual Studio Code.
- SAS
	- SAS 9.4 (other versions might work, but not tested)
	- All SAS macro dependencies are provided in `1_code/sas_macros`
- Stata
	- Stata 17+ (other versions might work, but not tested)
	- All Stata dependencies are documented in the `.do` file code using `ssc install ...`

## Hardware

The SAS and Stata code should run on any modern machine, however, two of the Python notebooks (`a_6b_parse_filings.ipynb` and `a_6c_calculate_text_metrics.ipynb`) are written to be executed on a Linux/Unix machine with a sufficient amount of RAM. Running this code on a Windows machine with less than 16gb of RAM will likely still work, however, the code is likely to take (much) longer. 

## Source data

In order to replicate the results, the following data sources need to be obtained and placed in the `0_data/external` folder:

- `spac_main.xlsx` which is the SPAC dataset from Blankespoor et al. (2022). The dataset was provided by the authors and is not yet publicly available. The data will be released on a future date through the supplementary materials of the paper: [https://pubsonline.informs.org/doi/abs/10.1287/mnsc.2022.4385](https://pubsonline.informs.org/doi/abs/10.1287/mnsc.2022.4385).
- `wrds_all_10qk_filings_07022022.xlsx` which is the 10-Q/K filing dataset downloaded through the WRDS web portal on July 2, 2022. A detailed set of instructions are included in `1_code/a_1_generate_filing_dataset.ipynb` on how to download this file. 

Placeholder files are included in the `0_data/external` folder to illustrate where they should be placed.

## Data licenses

In order to replicate the results, the following data licenses are needed:

- **WRDS**
	- Compustat
	- CRSP
	- Audit Analytics
    - WRDS SEC Analytics Suite
    - IBES
    - WRDS Linking Tables
    - Compustat Snapshot
    - Thomson-Reuters 13F Data

All the steps and/or code to retrieve the WRDS files is included in the `1_code` folder:
 
- `a_1_generate_filing_dataset.ipynb` for the 10-Q/K filing dataset. Downloaded through the web portal on July 2nd, 2022. The exact steps are detailed in the notebook.
- `a_5_calculate_auditor_variables.ipynb` for the auditor variables. Downloaded programatically through the WRDS PostgreSQL database on June 3rd 2022. The exact code is detailed in the notebook. 
- `b_1_download_wrds_data.sas` for all the other WRDS data. Downloaded through the WRDS - SAS connection on July 21st 2022. The exact code is detailed in the SAS file.

## Steps for end-to-end replication

1. Download and extract the replication packet to your computer.
	- **Important:** the root folder of the project has to be called `covid-empirical`, if you change this the code will not be able to automatically set your working directory and the code won't work.
2. Update the user specific parameters:
	1. Open up `config.yml` inside the `1_code` folder and add an entry after `linuxBox` with your preferred name and a location where you would like to store large files. This will be where large files are stored whenever the `ePipeline` variable is referenced in the Python code. 
	2. Update the `User` parameter at the top of all the Python notebooks with the name you added to `config.yml`. 
	3. Add your project folder path in the appropriate location in the preamble at the top of all the `.sas` and `.do` files.
3. Install the Python `covid-empirical` Anaconda environment:
    1. Download Anaconda or Miniconda, if you don't already have it ([link](https://www.anaconda.com/products/distribution))
	2. Using the Anaconda command prompt or terminal, change directory to the `1_code` folder and run `conda env create -f environment.yml`. This will create a new environment called `covid-empirical` with all the required packages.
    3. Activate the environment by running `conda activate covid-empirical`.
    4. Change the directory back to the root folder of the project and start Jupyter Notebook by running `jupyter notebook`.
4. Obtain the two source data files as per the instructions listed above and place them in the `0_data/external` folder.
5. Execute the code files in `1_code` in alphabetical order as per the file name:
    - `a_1_generate_filing_dataset.ipynb`
    - `a_2_identify_exemption_filers.ipynb`
    - `a_3_download_filing_deadlines.ipynb`
    - `a_4_calculate_calendar_bias.ipynb`
    - `a_5_calculate_auditor_variables.ipynb`
    - `a_6a_download_raw_filings.ipynb`
    - `a_6b_parse_filings.ipynb`
    - `a_6c_calculate_text_metrics.ipynb`
    - `b_1_download_wrds_data.sas`
    - `b_2_process_data.sas`
    - `c_1_generate_variables.do`
    - `c_2a_run_regressions_main.do`
    - `c_2b_run_regressions_appendix.do`
    - `c_2c_run_regressions_appendix_2018_vs_2019.do`
    - `c_3_generate_narrative_statistics.ipynb`
    - `c_4_calculate_calendar_bias_for_sample.ipynb`
6. The resulting tables and logs will show up in the respective `2_pipeline/<...>/out` and `3_output/logs` folders.

***Important note:*** Running all the code end-to-end will take a few days to complete, primarily due to the `a_6a_download_raw_filings.ipynb` and `a_6b_parse_filings.ipynb` notebooks. One could skip the code related to the narrative disclosures and modify the rest of the code accordingly to speed things up. 

----

# Tables and data dictionaries  

## **Calendar bias estimates in the writing**

*Page 11:*

> Hypothetically, if all firms followed day-week reporting patterns, the average change in EALag would be +1.38 days in Q1-2020, +0.58 in Q2-2020, -1.06 in Q3-2020, and -1.26 in Q4-2020, which could partially drive our results.

Generated in file:  `1_code/c_4_calculate_calendar_bias_for_sample.ipynb`

## **Table 1: Descriptive Statistics**

### ***Panels A and B***      

Generated in file: `1_code/c_2a_run_regressions_main.do`    

### ***Panel C***    

Generated in file: `1_code/c_3_generate_narrative_statistics.ipynb`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`BigChangeExp` | Indicator for absolute change in quarterly operating expenses >=10%.
`BigChangeSales` | Indicator is seasonal absolute change in quarterly sales >=10%.
`big_change` | 1 (-1) if EALag increase (decrease) >7 days from previous year-quarter. 0 otherwise.
`EADelay` | Days between the EA date and quarter-end.
`fdate_final` | 10K/Q filing date.
`FOG readability score` | FOG Readability score.
`GWImp_Ind` | Indicator for positive goodwill impairment.
`gvkey` | Firm identifier per Compustat.
`OtherSPI_Ind` | Indicator for positive absolute sum of other special items. OtherSPI include acquisition/merger, gain/loss on asset sales, settlements, debt extinguishment, in-process R&D, Other special items.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`rdq` | Earlier EA date per Compustat or IBES.
`RCPQ_Ind` | Indicator for positive asset restructuring costs.
`sec_delay_final` | Days between the 10K/Q filing date and quarter-end. 
`Untimely_filer` | Indicator if the firm did not file its 10K/Q within the standard SEC deadline.
`WDPQ_Ind` | Indicator for positive asset write-downs.
`# COVID mentions in MD&A` | Number of COVID mentions in the MD&A section of the form 10-K/Q.
`# COVID mentions in Risk Factor` | Number of COVID mentions in the risk factor section of the form 10-K/Q.
`# risk factors` | Number of risk factors items in the risk factor section of the form 10-K/Q.
`# sentences in MD&A` | Number of sentences in the MD&A section of the form 10-K/Q.

## **Table 2: Late 10-K/Q Filings**

### ***Panels A, B, C, and D***

Generated in file: `1_code/c_2a_run_regressions_main.do`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`Acc_f` | Indicator for Accelerated filers.
`choi_ofsize2_quintile` | Quintile of total audit office fees (Choi et al., 2010).
`closing_year_qtr` | Calendar quarter in which the firm's fiscal quarter end falls.
`fdate_final` | 10K/Q filing date.
`gvkey` | Firm identifier per Compustat.
`is_big_4` | Indicator if auditor is KPMG/PWC/EY/Deloitte.
`Large_Acc` | Indicator for Large Accelerated filers.
`LateFiler` | Indicator if firm did not file its 10K/Q within the standard SEC deadline with no exemption.
`LateFilerCOVID` | Indicator if firm did not file its 10K/Q within the standard SEC deadline by filing a COVID exemption.
`LateFilerNTa` |  Indicator if firm did not file its 10K/Q within the standard SEC deadline by filing an NT.
`new_auditor_office` | Indicator if change in auditor-office combination within last year.
`NUMEST` | Number of analysts contributing to the EPS consensus before the EA.
`NonAcc` | Indicator for Non-Accelerated filers.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.
`Untimely_Filer` | Indicator if firm did not file its 10K/Q within the standard SEC deadline.

## **Table 3: 10K/Q Filing Lags for On-Time Filers**

### ***Panels A and B***

Generated in file: `1_code/c_2a_run_regressions_main.do`  

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`fdate_final` | 10K/Q filing date.
`gvkey` | Firm identifier per Compustat.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`sec_delay_final` | Days between the 10K/Q filing date and quarter-end.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.

## **Table 4: EA Lags for On-Time Filers**

### ***Panels A, B, C, and D***

Generated in file: `1_code/c_2a_run_regressions_main.do`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`Acc_f` | Indicator for Accelerated filers.
`big_change` | 1 (-1) if EALag increase (decrease) >7 days from previous year-quarter. 0 otherwise.
`choi_ofsize2_quintile` | Quintile of total audit office fees (Choi et al., 2010).
`EADelay` | Days between the EA date and quarter-end.
`EALargeLag_1_Descriptive` | Indicator equal to 1 if big_change is equal to (1), otherwise zero.
`gvkey` | Firm identifier per Compustat.
`is_big_4` | Indicator if auditor is KPMG/PWC/EY/Deloitte.
`Large_Acc` | Indicator for Large Accelerated filers.
`new_auditor_office` | Indicator if change in auditor-office combination within last year.
`NonAcc` | Indicator for Non-Accelerated filers.
`NUMEST` | Number of analysts contributing to the EPS consensus before the EA.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`rdq` | Earlier EA date per Compustat or IBES.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.

## **Table 5: Reporting Quality**

### ***Panels A, B, C, and D***

Generated in file: `1_code/c_2a_run_regressions_main.do`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`bhar_d_m1_to_1` | Cumulative market-adjusted return over trading days (-1,+1) relative to the EA, adjusted for delisting returns (Beaver et al. 2007).
`c_betab`  | Stock market beta calculated over the preceding year relative to the EA date. This variable represents the de-meaned value.
`c_bmb`  | Book value of common equity divided by market value of equity as of the end of the fiscal quarter. This variable represents the de-meaned value.
`c_IORb`  | Institutional ownership defined as the percentage of shares held by institutions. This variable represents the de-meaned value.
`c_Log_MEb` |  Log of market value of equity. This variable represents the de-meaned value.
`c_Lognumestb`  | Log of 1 plus the number analysts contributing to the earnings consensus prior to the EA date. This variable represents the de-meaned value.
`c_LossEPSb`  | Indicator if EPS before extraordinary items is less than zero. This variable represents the de-meaned value.
`c_mturnoveravg_m12_to_datb` | Average monthly share trading volume over average monthly number of shares outstanding during the preceding year relative to the fiscal quarter end. This variable represents the de-meaned value.
`c_Predictb` | Variance of the absolute values of unexpected earnings over the preceding two years. This variable represents the de-meaned value.
`c_Post`| Indicator if the fiscal quarter-end is on or after January 1, 2020. This variable represents the de-meaned value.
`c_persistenceb`  | The AR(1) coefficient of regressing seasonally lagged EPS, calculated over the preceding two years. This variable represents the de-meaned value.
`c_rep_lagb`  | Difference between EA date and fiscal period end date. This variable represents the de-meaned value.
`c_UE_c_betab`  | Interaction between c_UE_m2_2_s_rb_s and c_betab.
`c_UE_c_bmb`  | Interaction between c_UE_m2_2_s_rb_s and c_bmb.
`c_UE_c_IORb`  | Interaction between c_UE_m2_2_s_rb_s and c_IORb.
`c_UE_c_Log_MEbv` | Interaction between c_UE_m2_2_s_rb_s and c_Log_MEb.
`c_UE_c_Lognumestb`  | Interaction between c_UE_m2_2_s_rb_s and c_Lognumestb.
`c_UE_c_LossEPSb`  | Interaction between c_UE_m2_2_s_rb_s and c_LossEPSb.
`c_UE_c_mturnoveravg_m12_to_datb` | Interaction between c_UE_m2_2_s_rb_s and c_mturnoveravg_m12_to_datb.
`c_UE_c_Post`| Interaction between c_UE_m2_2_s_rb_s and c_Post.
`c_UE_c_Predictb` | Interaction between c_UE_m2_2_s_rb_s and c_Predictb.
`c_UE_c_persistenceb`  | Interaction between c_UE_m2_2_s_rb_s and c_persistenceb.
`c_UE_c_rep_lagb`  | Interaction between c_UE_m2_2_s_rb_s and c_rep_lagb.
`c_UE_m2_2_s_rb_s`| Analyst-based unexpected earnings, scaled by price, and sorted into deciles by quarter. UE is then decile-ranked so that its value ranges from 0 to 1. This variable represents the de-meaned value.
`gvkey` | Firm identifier per Compustat.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`PremFinalDiff` | Indicator if the EPS number reported in an EA was subsequently revised in the 10K/Q. Only defined for non-concurrent reporters.
`rdq` | Earlier EA date per Compustat or IBES.
`TotalRestatement_App` | Indicator if the 10K/Q from that period was subsequently restated.

----

## **Table OA.1: Financial Reporting Quality Cross-Sectional Regressions**

### ***Panels A, B, C, D, E, and F***

Generated in file: `1_code/c_2b_run_regressions_appendix.do`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`big_change` | 1 (-1) if EALag increase (decrease) >7 days from previous year-quarter. 0 otherwise.
`fdate_final` | 10K/Q filing date.
`gvkey` | Firm indicator per Compustat.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`Post_big_change` | Interaction between Post and big_change.
`Post_sec_delay_final` | Interaction between Post and sec_delay_final.
`Post_Untimely_Filer` | Interaction between Post and Untimely_Filer.
`PremFinalDiff` | Indicator if the EPS number reported in an EA was subsequently revised in the 10K/Q. Only defined for non-concurrent reporters.
`rdq` | Earlier EA date per Compustat or IBES.
`sec_delay_final` | Days between the 10K/Q filing date and quarter-end.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.
`TotalRestatement_App` | Indicator if the 10K/Q from that period was subsequently restated.
`Untimely_Filer` | Indicator if firm did not file its 10K/Q within the standard SEC deadline.

## **Table OA.2: ERC Test Variable Definitions**

Variable definitions  table only, no data.

## **Table OA.3: Cross Sectional Tests - 10Ks versus 10Qs**

### ***Panels A and B***

Generated in file: `1_code/c_2b_run_regressions_appendix.do`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`big_change` | 1 (-1) if EALag increase (decrease) >7 days from previous year-quarter. 0 otherwise.
`EADelay` | Days between the EA date and quarter-end.
`fdate_final` | 10K/Q filing date.
`gvkey` | Firm identifier per Compustat.
`Ind10K` | Indicator that is 1 if the filing is a 10K and 0 if the filing is a 10Q.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`Post10K` | Indicator variable if the firm is filing a 10K and if Post equals (1).
`Post10Q` | Indicator variable if the firm is filing a 10Q and if Post equals (1).
`rdq` | Earlier EA date per Compustat or IBES.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.
`Untimely_Filer` | Indicator if firm did not file its 10K/Q within the standard SEC deadline.

## **Table OA.4: Did Firms Halt Guidance to Stay Timely**

### ***Panels A, B, and C***

Generated in file: `1_code/c_2b_run_regressions_appendix.do`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`big_change` | 1 (-1) if EALag increase (decrease) >7 days from previous year-quarter. 0 otherwise.
`fdate_final` | 10K/Q filing date.
`gvkey` | Firm identifier per Compustat.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`Post_AllOthers2019vs2020` | Indicator if Post equals (1) and firms are not considered stopped guiders in 2020.
`Post_AllOthers2019vs2021` | Indicator if Post equals (1) and firms are not considered stopped guiders in 2021.
`Post_Stop2019vs2020` | Indicator if Post equals (1) and firms stopped providing guidance in 2020, relative to 2019.
`Post_Stop2019vs2021` | Indicator if Post equals (1) and firms stopped providing guidance in 2021, relative to 2019.
`rdq` | Earlier EA date per Compustat or IBES.
`sec_delay_final` | Days between the 10K/Q filing date and quarter-end.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.
`Untimely_Filer` | Indicator if firm did not file its 10K/Q within the standard SEC deadline.

## **Table OA.5: Concurrent Reporters Tests**

### ***Panels A, B, and C***

Generated in file: `1_code/c_2b_run_regressions_appendix.do`   

**Note on Panel A:** The 2018 values to calculate the year-over-year change for the 2019 quarters are calculated in the file `1_code/c_2c_run_regressions_appendix_2018_vs_2019.do`.

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`big_change` | 1 (-1) if EALag increase (decrease) >7 days from previous year-quarter. 0 otherwise.
`Concurrent` | Indicator if the firm releases its EA within days (-1,0) of the 10K/Q filing (Arif et al. 2019).
`fdate_final` | 10K/Q filing date.
`gvkey` | Firm identifier per Compustat.
`NewConcurrentFinal2020or2021` | Indicator for firms that switch to concurrent status in the post-COVID period.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`rdq` | Earlier EA date per Compustat or IBES.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.

## **Table OA.6: California case study**

### ***Panels A, B, and C***

Generated in file: `1_code/c_2b_run_regressions_appendix.do`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`big_change` | 1 (-1) if EALag increase (decrease) >7 days from previous year-quarter. 0 otherwise.
`fdate_final` | 10K/Q filing date.
`gvkey` | Firm identifier per Compustat.
`Post` | Indicator if the fiscal quarter-end is on or after January 1, 2020.
`PostAllExceptCali` | Indicator variable the firm is not headquartered in California and if Post equals (1).
`PostCali` | Indicator variable the firm is headquartered in California and if Post equals (1).
`rdq` | Earlier EA date per Compustat or IBES.
`sec_delay_final` | Days between the 10K/Q filing date and quarter-end.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.
`Untimely_Filer` | Indicator if firm did not file its 10K/Q within the standard SEC deadline.

## **Table OA.7: Q4-2019 vs. Q4-2018**

### ***Panels A, B, and C***

Generated in file: `1_code/c_2c_run_regressions_appendix_2018_vs_2019.do`   

### ***Data dictionary:***

*Variable* | *Description*
------------ | ------------
`big_change` | 1 (-1) if EALag increase (decrease) >7 days from previous year-quarter. 0 otherwise.
`fdate_final` | 10K/Q filing date.
`gvkey` | Firm identifier per Compustat.
`Post2019` | Indicator if the fiscal quarter-end is on or after January 1, 2019.
`rdq` | Earlier EA date per Compustat or IBES.
`sec_delay_final` | Days between the 10K/Q filing date and quarter-end.
`sec_filing_limit` | Number of days between closing date and standard SEC filing deadline.
`Untimely_Filer` | Indicator if firm did not file its 10K/Q within the standard SEC deadline.

